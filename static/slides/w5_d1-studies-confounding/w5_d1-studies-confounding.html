<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Scientific studies and confounding   ðŸ˜–</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dr.Â Ã‡etinkaya-Rundel" />
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
    <link rel="stylesheet" href="../slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Scientific studies and confounding <br> ðŸ˜–
### Dr.Â Ã‡etinkaya-Rundel

---





layout: true
  
&lt;div class="my-footer"&gt;
&lt;span&gt;
Dr. Mine Ã‡etinkaya-Rundel -
&lt;a href="https://introds.org" target="_blank"&gt;introds.org
&lt;/a&gt;
&lt;/span&gt;
&lt;/div&gt; 

---



## Week 5

- Scientific studies, confounding, planning, and effective communication
- Project proposals
- Course and team evals
- Team meetings
- Regrade requests

.question[
.large[
Any questions?
]
]

---

class: center, middle

# Scientific studies

---

## Scientific studies

.pull-left[
**Observational**  
- Collect data in a way that does not interfere with how the data arise ("observe")
- Only establish an association
]
.pull-right[
**Experimental**  
- Randomly assign subjects to treatments
- Establish causal connections
]

&lt;br&gt;

--

.question[
ðŸ‘¥ Design a study comparing average energy levels of people who do and do not exercise -- both as an observational study and as an experiment.
]

<div class="countdown" id="timer_5da44871" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

## Study: Breakfast cereal keeps girls slim

.midi[
*Girls who ate breakfast of any type had a lower average body mass index, a common obesity gauge, than those who said they didn't. The index was even lower for girls who said they ate cereal for breakfast, according to findings of the study conducted by the Maryland Medical Research Institute with funding from the National Institutes of Health (NIH) and cereal-maker General Mills.*
 
[...]
 
*The results were gleaned from a larger NIH survey of 2,379 girls in California, Ohio, and Maryland who were tracked between the ages of 9 and 19.*
 
[...]
 
*As part of the survey, the girls were asked once a year what they had eaten during the previous three days.*
 
[...]
]

.question[
What is the explanatory and what is the response variable?
]

.footnote[
Souce: [Study: Cereal Keeps Girls Slim](https://www.cbsnews.com/news/study-cereal-keeps-girls-slim/), Retrieved Sep 13, 2018.
]

---

### 3 possible explanations

--

- Eating breakfast causes girls to be slimmer 

--
- Being slim causes girls to eat breakfast

--
- A third variable is responsible for both -- a **confounding** variable: an extraneous variable that affects both the explanatory and the response variable, and that make it seem like there is a relationship between them

---

## Correlation != causation

&lt;img src="img/xkcdcorrelation.png" width="80%" height="50%" style="display: block; margin: auto;" /&gt;

.footnote[
Randall Munroe CC BY-NC 2.5 http://xkcd.com/552/
]

---

## Stu!dies and conclusions

&lt;img src="img/random_sample_assign_grid.png" width="80%" height="50%" style="display: block; margin: auto;" /&gt;

---

class: center, middle

# Conditional probability

---

## Conditional probability

**Notation**: `\(P(A | B)\)`: Probability of event A given event B

- What is the probability that it be unseasonably warm tomorrow?
- What is the probability that it be unseasonably warm tomorrow, given that it it was unseasonably warm tomorrow?

---

.midi[
A July 2019 YouGov survey asked 1633 GB and 1333 USA randomly selected adults 
which of the following statements about the global environment best describes 
their view:
.small[
- The climate is changing and human activity is mainly responsible  
- The climate is changing and human activity is partly responsible, together with other factors  
- The climate is changing but human activity is not responsible at all  
- The climate is not changing  
]
The distribution of the responses by country of respondent is shown below.
]

&lt;br&gt;

.small[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is mainly responsible &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is partly responsible, together with other factors &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing but human activity is not responsible at all &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is not changing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Don't know &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GB &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 833 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 604 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 49 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 114 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1633 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; US &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 507 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 493 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 120 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 133 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1333 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1340 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1097 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 169 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 113 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 247 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2966 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.footnote[
Source: [YouGov - International Climate Change Survey](https://d25d2506sfb94s.cloudfront.net/cumulus_uploads/document/epjj0nusce/YouGov%20-%20International%20climate%20change%20survey.pdf)
]

---

.question[
ðŸ‘¥ 
- What percent of (1) all respondents, (2) GB respondents,  
(3) US respondents think the climate is changing and  
human activity is mainly responsible?  
- Based on the percentages you calculate, does there appear to be a relationship 
between country ands beliefs about climate change? Explain your reasoning.  
- If yes, could there be another variable that explains this relationship?
]

.small[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is mainly responsible &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is partly responsible, together with other factors &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing but human activity is not responsible at all &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is not changing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Don't know &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GB &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 833 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 604 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 49 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 114 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1633 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; US &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 507 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 493 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 120 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 133 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1333 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1340 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1097 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 169 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 113 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 247 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2966 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

<div class="countdown" id="timer_5da44ad2" style="top:0;right:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">04</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

## Independence

.question[
ðŸ‘¥ Inspired by the previous example and how we used the conditional probabilities to make conclusions, come up with a definition of independent events. If easier, you can keep the context limited to the example (independence/dependence of beliefs about climate change and country), but try to push yourself to make a more general statement.
]

<div class="countdown" id="timer_5da4482c" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

class: center, middle

# Simpson's paradox

---

## Relationships between variables

- Relationship between two variables: Fitness `\(\rightarrow\)` Heart health
- Relationship between multiple variables: Calories + Age + Fitness `\(\rightarrow\)` Heart health

---

## Relationship between two variables

&lt;table&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; y &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

--

&lt;img src="w5_d1-studies-confounding_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;
---

## Relationship between two variables

&lt;table&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; y &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;img src="w5_d1-studies-confounding_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;" /&gt;
---

## Considering a third variable

&lt;table&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; y &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; z &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;img src="w5_d1-studies-confounding_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" /&gt;

---

## Relationship between three variables

&lt;table&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; y &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; z &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;img src="w5_d1-studies-confounding_files/figure-html/unnamed-chunk-16-1.png" style="display: block; margin: auto;" /&gt;

---

## Simpson's paradox

- Not considering an important variable when studying a relationship can result 
in **Simpson's paradox**.
- Simpson's paradox illustrates the effect the omission of an explanatory 
variable can have on the measure of association between another explanatory 
variable and a response variable. 
- In other words, the inclusion of a third variable in the analysis can change 
the apparent relationship between the other two variables. 

---

## Berkeley admission data

- Study carried out by the graduate Division of the University of California, Berkeley in the early 70â€™s to evaluate whether there was a sex bias in graduate admissions.
- The data come from six departments. For confidentiality we'll call them A-F. 
- We have information on whether the applicant was male or female and whether they were admitted or rejected. 
- First, we will evaluate whether the percentage of males admitted is indeed higher than females, overall. Next, we will calculate the same percentage for each department.

---

## Data


```
## # A tibble: 4,526 x 3
##    admit    sex   dept 
##    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
##  1 Admitted Male  A    
##  2 Admitted Male  A    
##  3 Admitted Male  A    
##  4 Admitted Male  A    
##  5 Admitted Male  A    
##  6 Admitted Male  A    
##  7 Admitted Male  A    
##  8 Admitted Male  A    
##  9 Admitted Male  A    
## 10 Admitted Male  A    
## # â€¦ with 4,516 more rows
```

---

## Skim the data


```r
library(skimr)
*skim(ucb_admit)
```

```
## Skim summary statistics
##  n obs: 4526 
##  n variables: 3 
## 
## â”€â”€ Variable type:character â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
##  variable missing complete    n min max empty n_unique
##     admit       0     4526 4526   8   8     0        2
##      dept       0     4526 4526   1   1     0        6
##       sex       0     4526 4526   4   6     0        2
```

---

## Overall sex distribution

.question[
What can you say about the overall sex distribution? Hint: Calculate the following probabilities: `\(P(Admit | Male)\)` and `\(P(Admit | Female)\)`.
]


```r
ucb_admit %&gt;%
  count(sex, admit)
```

```
## # A tibble: 4 x 3
##   sex    admit        n
##   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;
## 1 Female Admitted   557
## 2 Female Rejected  1278
## 3 Male   Admitted  1198
## 4 Male   Rejected  1493
```

---

## Overall sex distribution

.question[
What type of visualization would be appropriate for representing these data?
]


```r
ucb_admit %&gt;%
  count(sex, admit) %&gt;%
  group_by(sex) %&gt;%
  mutate(prop_admit = n / sum(n))
```

```
## # A tibble: 4 x 4
## # Groups:   sex [2]
##   sex    admit        n prop_admit
##   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 Female Admitted   557      0.304
## 2 Female Rejected  1278      0.696
## 3 Male   Admitted  1198      0.445
## 4 Male   Rejected  1493      0.555
```

---

## Overall sex distribution


```r
ggplot(ucb_admit, mapping = aes(x = sex, fill = admit)) +
  geom_bar(position = "fill") + 
  labs(y = "", title = "Admit by sex")
```

![](w5_d1-studies-confounding_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;

---

## Sex distribution, by department

.question[
What can you say about the sex distribution by department ?
]


```r
ucb_admit %&gt;%
  count(dept, sex, admit)
```

```
## # A tibble: 24 x 4
##    dept  sex    admit        n
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;
##  1 A     Female Admitted    89
##  2 A     Female Rejected    19
##  3 A     Male   Admitted   512
##  4 A     Male   Rejected   313
##  5 B     Female Admitted    17
##  6 B     Female Rejected     8
##  7 B     Male   Admitted   353
##  8 B     Male   Rejected   207
##  9 C     Female Admitted   202
## 10 C     Female Rejected   391
## # â€¦ with 14 more rows
```

---

## Sex distribution, by department

.question[
ðŸ‘¥ Let's try again...  
What can you say about the sex distribution by department?
]


```r
ucb_admit %&gt;%
  count(dept, sex, admit) %&gt;%
  pivot_wider(names_from = dept, values_from = n)
```

```
## # A tibble: 4 x 8
##   sex    admit        A     B     C     D     E     F
##   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 Female Admitted    89    17   202   131    94    24
## 2 Female Rejected    19     8   391   244   299   317
## 3 Male   Admitted   512   353   120   138    53    22
## 4 Male   Rejected   313   207   205   279   138   351
```

<div class="countdown" id="timer_5da44909" style="top:0;right:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

## Sex distribution, by department

.question[
What type of visualization would be appropriate for representing these data?
]

.small[

```r
ucb_admit %&gt;%
  count(dept, sex, admit) %&gt;%
  group_by(dept, sex) %&gt;%
  mutate(perc_admit = n / sum(n)) %&gt;%
  filter(admit == "Admitted")
```

```
## # A tibble: 12 x 5
## # Groups:   dept, sex [12]
##    dept  sex    admit        n perc_admit
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;      &lt;dbl&gt;
##  1 A     Female Admitted    89     0.824 
##  2 A     Male   Admitted   512     0.621 
##  3 B     Female Admitted    17     0.68  
##  4 B     Male   Admitted   353     0.630 
##  5 C     Female Admitted   202     0.341 
##  6 C     Male   Admitted   120     0.369 
##  7 D     Female Admitted   131     0.349 
##  8 D     Male   Admitted   138     0.331 
##  9 E     Female Admitted    94     0.239 
## 10 E     Male   Admitted    53     0.277 
## 11 F     Female Admitted    24     0.0704
## 12 F     Male   Admitted    22     0.0590
```
]

---

## Sex distribution, by department


```r
ggplot(ucb_admit, mapping = aes(x = sex, fill = admit)) +
  geom_bar(position = "fill") +
  facet_grid(. ~ dept) +
  labs(x = "Sex", y = "", fill = "Admission",
       title = "Admit by sex by department")
```

![](w5_d1-studies-confounding_files/figure-html/unnamed-chunk-26-1.png)&lt;!-- --&gt;

---

## Sex distribution, by department

.small[

```r
ggplot(ucb_admit, mapping = aes(x = sex, fill = admit)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = percent) +
  facet_wrap(. ~ dept) +
  coord_flip() +
  labs(x = "", y = "", fill = "", title = "Admissions by sex and department") +
  theme(legend.position = "bottom")
```

![](w5_d1-studies-confounding_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;
]

---

![](w5_d1-studies-confounding_files/figure-html/unnamed-chunk-28-1.png)&lt;!-- --&gt;

![](w5_d1-studies-confounding_files/figure-html/unnamed-chunk-29-1.png)&lt;!-- --&gt;

---

class: center, middle

# group_by

---

## What does group_by() do?

`group_by()` takes an existing `tbl` and converts it into a grouped `tbl` where operations are performed "by group":

.pull-left[

```r
ucb_admit
```

```
## # A tibble: 4,526 x 3
##    admit    sex   dept 
##    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
##  1 Admitted Male  A    
##  2 Admitted Male  A    
##  3 Admitted Male  A    
##  4 Admitted Male  A    
##  5 Admitted Male  A    
##  6 Admitted Male  A    
##  7 Admitted Male  A    
##  8 Admitted Male  A    
##  9 Admitted Male  A    
## 10 Admitted Male  A    
## # â€¦ with 4,516 more rows
```
]
.pull-right[

```r
ucb_admit %&gt;% 
  group_by(sex)
```

```
## # A tibble: 4,526 x 3
## # Groups:   sex [2]
##    admit    sex   dept 
##    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
##  1 Admitted Male  A    
##  2 Admitted Male  A    
##  3 Admitted Male  A    
##  4 Admitted Male  A    
##  5 Admitted Male  A    
##  6 Admitted Male  A    
##  7 Admitted Male  A    
##  8 Admitted Male  A    
##  9 Admitted Male  A    
## 10 Admitted Male  A    
## # â€¦ with 4,516 more rows
```
]

---

## What does group_by() not do?

`group_by()` does not sort the data, `arrange()` does:

.pull-left[

```r
ucb_admit %&gt;% 
  group_by(sex)
```

```
## # A tibble: 4,526 x 3
## # Groups:   sex [2]
##    admit    sex   dept 
##    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
##  1 Admitted Male  A    
##  2 Admitted Male  A    
##  3 Admitted Male  A    
##  4 Admitted Male  A    
##  5 Admitted Male  A    
##  6 Admitted Male  A    
##  7 Admitted Male  A    
##  8 Admitted Male  A    
##  9 Admitted Male  A    
## 10 Admitted Male  A    
## # â€¦ with 4,516 more rows
```
]
.pull-right[

```r
ucb_admit %&gt;% 
  arrange(sex)
```

```
## # A tibble: 4,526 x 3
##    admit    sex    dept 
##    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;
##  1 Admitted Female A    
##  2 Admitted Female A    
##  3 Admitted Female A    
##  4 Admitted Female A    
##  5 Admitted Female A    
##  6 Admitted Female A    
##  7 Admitted Female A    
##  8 Admitted Female A    
##  9 Admitted Female A    
## 10 Admitted Female A    
## # â€¦ with 4,516 more rows
```
]

---

## What does group_by() not do?

`group_by()` does not create frequency tables, `count()` does:

.pull-left[

```r
ucb_admit %&gt;% 
  group_by(sex)
```

```
## # A tibble: 4,526 x 3
## # Groups:   sex [2]
##    admit    sex   dept 
##    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
##  1 Admitted Male  A    
##  2 Admitted Male  A    
##  3 Admitted Male  A    
##  4 Admitted Male  A    
##  5 Admitted Male  A    
##  6 Admitted Male  A    
##  7 Admitted Male  A    
##  8 Admitted Male  A    
##  9 Admitted Male  A    
## 10 Admitted Male  A    
## # â€¦ with 4,516 more rows
```
]
.pull-right[

```r
ucb_admit %&gt;% 
  count(sex)
```

```
## # A tibble: 2 x 2
##   sex        n
##   &lt;chr&gt;  &lt;int&gt;
## 1 Female  1835
## 2 Male    2691
```
]

---

## Undo grouping with ungroup()

.pull-left[

```r
ucb_admit %&gt;%
  count(sex, admit) %&gt;%
  group_by(sex) %&gt;%
  mutate(prop_admit = n / sum(n)) %&gt;%
  select(sex, prop_admit)
```

```
## # A tibble: 4 x 2
## # Groups:   sex [2]
##   sex    prop_admit
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 Female      0.304
## 2 Female      0.696
## 3 Male        0.445
## 4 Male        0.555
```
]
.pull-right[

```r
ucb_admit %&gt;%
  count(sex, admit) %&gt;%
  group_by(sex) %&gt;%
  mutate(prop_admit = n / sum(n)) %&gt;%
  select(sex, prop_admit) %&gt;%
  ungroup()
```

```
## # A tibble: 4 x 2
##   sex    prop_admit
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 Female      0.304
## 2 Female      0.696
## 3 Male        0.445
## 4 Male        0.555
```
]

---

class: center, middle

# count

---

## count() is a short-hand

`count()` is a short-hand for `group_by()` and then `summarise()` to count the number of observations in each group:

.pull-left[

```r
ucb_admit %&gt;%
  group_by(sex) %&gt;%
  summarise(n = n()) 
```

```
## # A tibble: 2 x 2
##   sex        n
##   &lt;chr&gt;  &lt;int&gt;
## 1 Female  1835
## 2 Male    2691
```
]
.pull-right[

```r
ucb_admit %&gt;%
  count(sex)
```

```
## # A tibble: 2 x 2
##   sex        n
##   &lt;chr&gt;  &lt;int&gt;
## 1 Female  1835
## 2 Male    2691
```
]

---

## count can take multiple arguments

.pull-left[

```r
ucb_admit %&gt;%
  group_by(sex, admit) %&gt;%
  summarise(n = n()) 
```

```
## # A tibble: 4 x 3
## # Groups:   sex [2]
##   sex    admit        n
##   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;
## 1 Female Admitted   557
## 2 Female Rejected  1278
## 3 Male   Admitted  1198
## 4 Male   Rejected  1493
```
]
.pull-right[

```r
ucb_admit %&gt;%
  count(sex, admit)
```

```
## # A tibble: 4 x 3
##   sex    admit        n
##   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;
## 1 Female Admitted   557
## 2 Female Rejected  1278
## 3 Male   Admitted  1198
## 4 Male   Rejected  1493
```
]

---

.question[
What is the difference between the two outputs?
]

.small[
.pull-left[

```r
ucb_admit %&gt;%
  group_by(sex, admit) %&gt;%
  summarise(n = n()) 
```

```
## # A tibble: 4 x 3
## # Groups:   sex [2]
##   sex    admit        n
##   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;
## 1 Female Admitted   557
## 2 Female Rejected  1278
## 3 Male   Admitted  1198
## 4 Male   Rejected  1493
```
]
.pull-right[

```r
ucb_admit %&gt;%
  count(sex, admit)
```

```
## # A tibble: 4 x 3
##   sex    admit        n
##   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;
## 1 Female Admitted   557
## 2 Female Rejected  1278
## 3 Male   Admitted  1198
## 4 Male   Rejected  1493
```
]
]

&lt;br&gt;&lt;br&gt;

--

- `count()` ungroups after itself
- `summarise()` peels off one layer of grouping
- The question mark just means that the number of groups is unkown right now, it will only be computed when/if the next line is executed
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
